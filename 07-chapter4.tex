\chapter{НАУЧНАЯ СОСТАВЛЯЮЩАЯ}
\label{chap:research}
\aftertitle

В этой главе рассматривается экспериментальная работа по проверке разработанного сервиса и анализу новостей с его помощью. Описаны проведенные эксперименты по анализу новостей.

В исследовании использовались исторические данные новостей, собранные за 2020 год.

\section{Анализ количества новостей}

В первую очередь был произведен анализ количества новостей в день за исследуемый промежуток времени. На рисунке \ref{img:news-count} представлен график количества новостей за день. Минимальное количество новостей в день 165, максимальное ~-- 2890, а среднее ~--- 1907.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/news-count.png}
    \caption{Количество новостей в день}
    \label{img:news-count}
\end{figure}

\section{Исследование расстояния между новостями}

Была изучена статистика попарного косинусного расстояния между векторным представлением новостей за день.

Косинусное расстояние двух векторов $a$ и $b$ ~-- это метрика схожести двух ненулевых векторов, определяемая как косинус угла между ними (\ref{eq:cosine-dist}).

\begin{equation}
    cos(\theta) = \frac{\vec{a} \cdot \vec{b}}{||\vec{a}|| \cdot ||{b}||}
    \label{eq:cosine-dist}
\end{equation}

Таким образом, эмбеддинги близких по смыслу новостей будут представлять собой два вектора с приблизительно одинаковым направлением, и их косинусное расстояние будет близко к единице. Наоборот, эмбеддинги противоположных по смыслу новостей будут представлять собой два вектора, направленные в противоположенные стороны, и их косинусное расстояние будет близко к минус единице. Таким образом, чем ближе косинусное расстояние к единице, тем более похожи новости.

Так как косинусное расстояние между векторным представлением соответствует семантической близости новостей друг другу, то статистика попарных расстояний может отражать характер распределения новостей по темам. Если за выбранный временной интервал много новостей на различные, то косинусное расстояние между ними будет близко к -1, и статистика попарных расстояния будут сдвинута в сторону меньших значений. Наоборот, если новости за выбранный временной интервал были на схожие темы, то косинусное расстояние будет близко к 1 , и статистика распределения попарных расстояний будет сдвинута в сторону больших значений.

На рисунке \ref{img:distances-distribution} показано сравнение распределения попарных косинусных расстояний за два дня. Распределение в области малых значений, т.е. новостей, которые не похожи друг на друга, совпадает. Различие наблюдается в области больших значений, т.е. новостей, которые похожи друг на друга. За один день наблюдается большее значение плотности распределения в области больших значений, чем за другой день, что говорит о том, что в этот день было больше новостей на близкие темы.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/distances-distribution.png}
    \caption{Сравнение распределение косинусного расстояния между новостями за два дня}
    \label{img:distances-distribution}
\end{figure}

Так как построение распределения для всех дней не является наглядной визуализацией, то для изучения динамики изменения распределения попарных косинусных расстояний межу новостями, было решено построить графики отдельных квантилей: 50\% (медиана), 75\% и 90\%. График изменения распределения попарного косинусного расстояния по дням представлен на рисунке \ref{img:distances}.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/distances.png}
    \caption{Изменение распределения попарного косинусного расстояния по дням}
    \label{img:distances}
\end{figure}

На этом графике показаны значения трех квантилей: 50\% (синий), 75\% (оранжевый) и 90\% (зеленый) в виде точек. Каждая точка показывает значение соответствующего квантиля распределения попарного косинусного расстояния между новостями за один день. На графике мы  можем отчетливо видеть колебания с периодом 7 дней, по всей видимости, связанные с недельными изменениями в  распределении тематик новостей.

Значения 50\% квантиля практически не изменяются во времени, не считая недельных колебаний. Это согласуется с рассмотренным ранее на рисунке \ref{img:distances-distribution} сравнением распределения попарных косинусных расстояний между новостями за два дня, на котором видно, что в области малых значений распределение практически совпадает. Медианное значение 50\%-квантиля составляет 0.12, что соответствует непохожим новостям. Таким образом, распределение непохожих новостей мало меняется во времени, что может говорить о том, что в новостях всегда (за исключением недельных колебаний) охватывается примерно одинаково широкий круг тем.

Поведение значения 75\% квантиля мало отличается от поведения значений 50\% квантиля, но в них наблюдается небольшое увеличение в определенные моменты времени.

Наибольший интерес представляет поведение 90\% квантиля. Среди этих значений недельные колебания не так выражены, но выражен значительный рост значений в определенный период времени. Это говорит о том, что в этот момент времени распределение попарных косинусных расстояний между новостями было смещено в область больших значений, т.е. было больше новостей на похожие темы. По времени этот момент совпадает с началом пандемии коронавируса, карантина и экономического кризиса. Вероятно, эти темы обсуждались более активно, чем другие, что вызвало появление большего количества новостей на сходные тематики и смещение распределения попарного косинусного расстояния между новостями.

Таким образом, исследование распределения попарного косинусного расстояния между новостями может служить инструментом для выявления периодов с активным обсуждением тех или иных тем. При этом, наибольший интерес представляют больше квантили, такие как 90\%-квантиль.

\section{Исследование кросс-корреляции с финансовым инструментом}

Реализованный в данной работе сервис позволяет оценивать корреляцию количества новостей по заданным темам с различными временными рядами. В качестве примера, была изучена кросс-корреляция количества новостей по различным темам с ценой финансового инструмента ~-- с курсом доллара по отношению  к рублю, чтобы изучить, как разработанный сервис может быть использован в исследованиях финансовых рынков.

Для этого использовалось API сервиса /api/v1/correlations. С помощью этого API определялось количество новостей по заданным темам за данные промежутки времени и рассчитывалась корреляция с курсом доллара. Количество новостей определялось за окно длительностью 7 дней, которое сдвигалось с шагом 6 часов. Такое окно было выбрано, чтобы сгладить недельные колебания в количестве новостей.

Анализировалась корреляция абсолютного количества новостей с курсом доллара, корреляция относительного количества новостей с курсом доллара и корреляция абсолютного количества новостей с производной курса доллара.

\subsection{Корреляция количества новостей с курсом доллара}

Для исследования были выбраны следующие темы, которые могли бы быть актуальны на исследуемый период: экономика, политика, коронавирус, самоизоляция, курс доллара, фондовый рынок, нефть, кризис, акции.

Перед расчётом кросс-корреляции, значение количества новостей и стоимости доллара нормировались таким образом, чтобы попасть в диапазон $[-1; 1]$. Нормировка осуществлялась с помощью класса MinMaxScaler из библиотеки scikit-learn.

Графики корреляции количества новостей по темам "нефть" и "коронавирус" приведены на рисунке \ref{img:correlation-absolute}. На верхних половинах графиков показаны нормированные значения количества новостей (оранжевый) и курса доллара (синий). На нижних половинах графиков показано значение корреляционной функции (синий).

По данным графикам затруднительно сделать какие-либо выводы о влияние изменения стоимости финансового инструмента на новости и наоборот.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/correlations/absolute/нефть.png}
    \includegraphics[width=\linewidth]{images/correlations/absolute/коронавирус.png}
    \caption{Корреляция количества новостей по различным темам с курсом доллара}
    \label{img:correlation-absolute}
\end{figure}


\subsection{Корреляция относительного количества новостей с курсом доллара}

Рассмотрим аналогичные графики, но для относительного количества новостей. Количество новостей по той или иной теме было нормировано на общее количество новостей за день, чтобы не учитывать влияние количества новостей, а только относительную долю рассматриваемой теме в общем количестве новостей за заданный временной интервал.

Графики корреляции относительного количества новостей по темам "нефть" и "коронавирус" приведены на рисунке \ref{img:correlation-relative}. На верхних половинах графиков показаны нормированные значения количества новостей (оранжевый) и курса доллара (синий). На нижних половинах графиков показано значение корреляционной функции (синий).

По данным графикам затруднительно сделать какие-либо выводы о влияние изменения стоимости финансового инструмента на новости и наоборот.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/correlations/relative/нефть.png}
    \includegraphics[width=\linewidth]{images/correlations/relative/коронавирус.png}
    \caption{Корреляция относительного количества новостей по различным темам с курсом доллара}
    \label{img:correlation-relative}
\end{figure}

\subsection{Корреляция количества новостей с производной курсом доллара}

Было выдвинуто предположение, что в новостях отражается не сколько сам курс доллара, сколько его изменения. В периоды, когда курс доллара приблизительно стабилен, это не находит активного отражения в новостях. В периоды, когда происходят сильные колебания курса доллара, это находит активное отражение в новостях, как в специализирующихся на экономике изданиях, так и в общих средствах массовой информации.

Для того, чтобы проанализировать корреляцию количества новостей с изменениями курса доллара, курс доллара был численно дифференцирован. Для дифференцирования применялась центральная разностная схема (\ref{eq:derrivative}). Регулируя параметр шага можно влиять на сглаженность производной. Т.к. курс доллара имеет множество мелких колебаний, то для анализа только крупных изменений, шаг дифференцирования может быть увеличен.

\begin{equation}
    C'_i \approx \frac{C_{i+n} - C_{i-n}}{2n}
    \label{eq:derrivative}
\end{equation}
\noindent\begin{tabularx}{\linewidth}{lllX}
    где & $C_i$    &~--& стоимость в момент времени $i$, \\
        & $i$      &~--& момент времени, \\
        & $n$      &~--& шаг. \\
\end{tabularx}

На рисунке \ref{img:usd_derrivative} показан курс доллара (верхний) и производная курса доллара (нижний) за рассматриваемый период.

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/correlations/usd_derrivative.png}
    \caption{Производная курса доллара}
    \label{img:usd_derrivative}
\end{figure}

Для расчёта корреляции необходимо нормализовать данные. Но для производной курса доллара MinMaxScaler не подходит, потому что при его применении может произойти сдвиг нуля, а нуль имеет важное значение для производной курса, обозначая отсутствие изменений. Поэтому, был применен другой способ нормализации, который масштабирует размах функции в интервал $[-1; 1]$, но сохраняет положение нуля (\ref{eq:derr-normalize}). Данный способ определяет максимальный размах значения функции от нуля и масштабирует ее таким образом, чтобы максимальный размах составлял единицу.

\begin{equation}
    \begin{array}{l}
        k = max(max(C'), -min(C')), \\
        C'_{norm} = k \cdot C'
    \end{array}
    \label{eq:derr-normalize}
\end{equation}\noindent\begin{tabularx}{\linewidth}{lllX}
    где & $C'$         &~--& производная стоимости, \\
        & $C'_{norm}$  &~--& нормированная производная стоимости. \\
\end{tabularx}


Используя рассмотренный способ нормализации, была рассчитана корреляция между количеством новостей по определенным темам и производной курса доллара.

Графики корреляции относительного количества новостей по темам "нефть" и "коронавирус" приведены на рисунке \ref{img:correlation-derrivative}. На верхних половинах графиков показаны нормированные значения количества новостей (оранжевый) и курса доллара (синий). На нижних половинах графиков показано значение корреляционной функции (синий).

\begin{figure}[h]
    \centering
    \includegraphics[width=\linewidth]{images/correlations/derivative/нефть.png}
    \includegraphics[width=\linewidth]{images/correlations/derivative/коронавирус.png}
    \caption{Корреляция количества новостей по различным темам с производной курса доллара}
    \label{img:correlation-derrivative}
\end{figure}

Использование производной курса доллара позволило улучшить результаты. Теперь на графиках корреляции отчетливо видны моменты корреляции сильных изменений курса и обсуждений определенных тем, в то время как в остальные моменты времени значение корреляции около нуля.
